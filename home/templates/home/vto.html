<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eshtyle | Virtual Try-On</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<style>
    #modal {
        display: none;
    }
    #modal.active {
        display: block;
    }
    #process{
        display:none;
    }
</style>
<body class="bg-[#1f1f1f]" >
    <nav class="w-full h-auto border-b border-gray-700">
        <div class="container mx-auto max-w-xl ">
            <a href="{{shop_link}}" target="_blank"><img class="mx-auto w-[40%]" src="{{shop_logo}}" /></a> 
            <div class="flex justify-center items-center text-white">
                {{shop_name}} partnered with 
                    <a href="https://eshtyle.com" class="inline-flex items-center" target="_blank" style="color:white;text-decoration:none;    margin-left: -1rem;">
                        <img src="https://www.eshtyle.com/assets/Eshtyle-logo-1ae0b643.png" style="width:5rem;border:0px;margin-right:-1.4rem;" alt="">
                shtyle 
                    </a>
                
            </div>

        </div>
    </nav>
    <div class="container mx-auto h-auto" >
        <div class="grid grid-cols-1 lg:grid-cols-12 ">
            <div class="col-span-1 md:h-auto lg:col-span-3 border-r border-gray-700 p-4 text-white">
                <div style="    justify-content: center;display: flex;flex-direction: column;text-align: center;padding: 1rem;border: 1px dashed;">

                    <p class="text-xl font-bold">Body Image Upload</p>
                    <button onclick="openModal()" class="bg-[#d5df46] hover:bg-[#d5e310] text-gray-800 font-bold py-2 px-4 rounded mt-4">
                        Upload Full Body Image
                    </button>
                </div>  
                <div id="submittedImageContainer" class="mt-4">
                    <!-- Preview image will be displayed here after submission -->
                </div>
                <div class="mt-4 text-gray-400">
                    <h3 class="text-lg font-bold mb-2">Steps for Virtual Try-On:</h3>

                        <ol class="list-decimal list-inside space-y-2">
                            <li>
                                <strong>Step 1: Upload Full-Body Image</strong>
                                <ul class="md:block hidden text-[0.9rem] list-disc list-inside ml-4">
                                    <li>Provide a clear option for users to upload a full-body image of themselves.</li>
                                    <li>Ensure the upload supports common image formats (e.g., JPG, PNG).</li>
                                    <li>Confirm that the uploaded image meets the required criteria (e.g., full-body, proper resolution).</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Step 2: Select T-Shirt</strong>
                                <ul class="md:block hidden text-[0.9rem] list-disc list-inside ml-4">
                                    <li>Display a range of t-shirt options for users to choose from.</li>
                                    <li>Allow users to easily select their desired t-shirt by clicking on it.</li>
                                    <li>Highlight the selected t-shirt to indicate the user's choice.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Step 3: Submit or Create Virtual Try-On</strong>
                                <ul class="md:block hidden text-[0.9rem] list-disc list-inside ml-4">
                                    <li>Provide a button labeled "Create Virtual Try-On" for submitting the selected image and t-shirt.</li>
                                    <li>Ensure the button is only enabled after both the image is uploaded and a t-shirt is selected.</li>
                                    <li>Process the image and t-shirt selection to generate the virtual try-on preview upon submission.</li>
                                </ul>
                            </li>
                        </ol>
                </div>


            </div>
            <div class="col-span-1 lg:col-span-5  p-4 text-white">
                <p class="text-xl font-bold">Seleced Image Catalogue</p>
                <div id="gallery" class="mt-4">
                    <div id="activeImageContainer" class="mb-4 mx-auto flex justify-center">
                        <img id="activeImage" src="{{product_image_url}}" alt="Active Image" class="w-[50%] h-auto max-auto">
                    </div>
                     {% comment %} <div class="grid grid-cols-4 gap-2">
                        <img onclick="setActiveImage(this)" src="https://unblast.com/wp-content/uploads/2023/10/Blank-T-shirt-Mockup.jpg" alt="Image 1" class="cursor-pointer w-full h-auto">
                        <img onclick="setActiveImage(this)" src="https://cdn.shopify.com/s/files/1/0613/4913/4390/files/Muselot-Old-school-is-cool-printed-t-shirts-in-golden-yellow-color.webp" alt="Image 2" class="cursor-pointer w-full h-auto">
                        <img onclick="setActiveImage(this)" src="https://unblast.com/wp-content/uploads/2021/10/Simple-Hoodie-Mockup.jpg" alt="Image 3" class="cursor-pointer w-full h-auto">
                        <img onclick="setActiveImage(this)" src="https://via.placeholder.com/150" alt="Image 4" class="cursor-pointer w-full h-auto">
                    </div>  {% endcomment %}
                    {% if shop_status == 'unauthorized' %}
                    <h4 class="text-red-500 text-xl font-bold">Your access token is inactive or unauthorized. Please contact support for assistance.</h4>
                    <button  class="bg-[#d5df46] hover:bg-[#d5e310] w-full text-gray-800 font-bold py-2 px-4 rounded mt-4" readonly>
                        Create V-Tryon
                        </button>
                    {% else %}
                    <button id="submitbutton"onclick="createFormDataAndScroll()"class="bg-[#d5df46] hover:bg-[#d5e310] w-full text-gray-800 font-bold py-2 px-4 rounded mt-4">
                        Create V-Tryon
                        </button>
                    {% endif %} 
                    <div class="mt-4 text-gray-400">
                        <h3 class="text-lg font-bold mb-2">Important ***:</h3>
                        <p><strong>Submit/Generate:</strong> Click to try on your selected outfit. Our AI (Model V1) is in use and may take some time to process. We are actively developing Model V2 for faster processing.</p>
                        <p><strong>View Your Virtual Try-On:</strong> If our system is busy, we'll notify you once your virtual try-on is ready. Please note that results may vary based on image quality and pose.</p>
                        <p><strong>Disclaimer:</strong> Results are AI-generated. If you're not in the queue, your new look will be displayed instantly. Our AI (Model Version V2) is under development for improved efficiency.</p>
                        
                        
                    </div>
                </div>
            </div>
            <div id="vTryonContainer" class="col-span-1 lg:col-span-4 border-l border-gray-700 p-4 text-black">
                <p class="text-white text-xl font-bold">Generated Image</p>
                <img src="https://ideogram.ai/assets/image/lossless/response/pend0BoISVavvc9vagg5_A" id="output_img" class="mx-auto w-80 my-12"/>
                <div class="mt-4 text-gray-400" id="process">
                    <p> <strong>Please wait it took sometime to process...</strong></p>
                    
                    
                </div>
            </div>
        </div>
    </div>





    

<footer class="bg-white rounded-lg shadow m-4 dark:bg-gray-800">
    <div class="w-full mx-auto max-w-screen-xl p-4 md:flex md:items-center md:justify-between">
      <span class="text-sm text-gray-500 sm:text-center dark:text-gray-400">© 2024 <a href="https://zenrevo.com/" class="hover:underline">Zenrevo™</a>. All Rights Reserved.
    </span>
    <ul class="flex flex-wrap items-center mt-3 text-sm font-medium text-gray-500 dark:text-gray-400 sm:mt-0">
   
        <li>
            <a href="#" class="hover:underline me-4 md:me-6">Privacy Policy</a>
        </li>
        <li>
            <a href="#" class="hover:underline me-4 md:me-6">Licensing</a>
        </li>
        <li>
            <a href="https://www.eshtyle.com/contact" target="_blank"class="hover:underline">Contact</a>
        </li>
    </ul>
    </div>
</footer>










     <!-- Modal -->
     <div id="modal" class="w-full h-screen">

         <div  class="fixed inset-0  bg-gray-800 bg-opacity-75 flex justify-center items-center modalx">
            <div class="bg-white p-8 rounded-lg shadow-lg w-1/2" style="    width: auto;">
                <h2 class="text-2xl mb-4">Upload Full Body Image</h2>
                <!-- <input type="file" id="imageUpload" accept="image/*" onchange="previewImage(event)" class="mb-4"> -->
                <input type="file" id="imageUpload" accept="image/*" onchange="previewImage(event)" style="margin: 2rem 0rem;;background: aliceblue;border: 1px dashed;" class="block w-full text-sm text-slate-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0
                    file:text-sm file:font-semibold
                    file:bg-violet-50 file:text-violet-700
                    hover:file:bg-violet-100
                "/>
                <div class="overflow-y-auto max-h-[70vh]">
                <img id="imagePreview" src="#" alt="Image Preview" class="hidden w-full max-h-[70vh] object-contain">
                <div class="flex gap-2 border-t w-full h-32">
                    <img src="https://www.shutterstock.com/image-photo/halfbody-portrait-satisfied-business-man-260nw-2061789662.jpg" class="mx-auto"/>
                    <img src="https://ideogram.ai/assets/image/lossless/response/pend0BoISVavvc9vagg5_A" class="mx-auto"/>

                </div>
            </div>
                <!-- <img id="imagePreview" src="#" alt="Image Preview" class="hidden w-80 h-100"> -->
                <div class="mt-4">
                    <button onclick="closeModal()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                        Close
                    </button>
                    <button onclick="submitImage()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                        Submit
                    </button>
                </div>
            </div>
        </div>
     </div>


    <script>
        function openModal() {
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function previewImage(event) {
            const input = event.target;
            const reader = new FileReader();
            reader.onload = function() {
                const preview = document.getElementById('imagePreview');
                preview.src = reader.result;
                preview.classList.remove('hidden');
            };
            reader.readAsDataURL(input.files[0]);
        }

        function submitImage() {
            const previewSrc = document.getElementById('imagePreview').src;
            const submittedImageContainer = document.getElementById('submittedImageContainer');

            const imgElement = document.createElement('img');
            imgElement.src = previewSrc;
            imgElement.classList.add('w-full', 'h-auto', 'mt-4');
            imgElement.id = "model_image";
            // Clear any existing images before adding the new one
            submittedImageContainer.innerHTML = '';
            submittedImageContainer.appendChild(imgElement);

            closeModal();
        }

        



    </script>



    <script>
        function createFormDataAndScroll() {
            createFormData(); // Assuming createFormData() creates the form data
            document.getElementById('submitbutton').disabled = true;
            scrollToElement('vTryonContainer');
        }
        
        function scrollToElement(elementId) {
            var element = document.getElementById(elementId);
            if (element) {
                // Scroll to the element
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        function createFormData() {
            const formData = new FormData();
            
            // Get the file input elements
            const modelImageElement = document.getElementById('model_image');
            formData.append('cloth', document.getElementById('activeImage').src );
            formData.append('shop_id', {{shop_id}} );

        
        
            // Check if model image is available
            if (modelImageElement && modelImageElement.src) {
                // Convert the model image URL to a Blob object
                fetch(modelImageElement.src)
                    .then(response => response.blob())
                    .then(blob => {
                        // Append the model image Blob to the FormData object
                        formData.append('model_image', blob, 'model_image.png');
                        
                        // Send the form data after appending the model image
                        sendFormData(formData);
                    });
            } else {
                alert('Model image is missing.');
                return null;
            }
        
            return formData;
        }
        
        function sendFormData(formData) {

            console.log("FormData being sent:", formData);
            fetch('https://virtual-try-on.eshtyle.com/api/v2', {
                method: 'POST',
                body: formData,
            })
            .then(response => {
                console.log(response.json);
                if (!response.ok) {
                    return response.json().then(err => { throw new Error(err); });
                }
                return response.json();
            })
            .then(data => {
                console.log('Submission successful:', data);
                if (data.error) {
                    alert(data.message);
                } else {
                    localStorage.setItem('vtonId', data.id);
                    alert(data.message + ' Please  wait....');
                    document.getElementById('output_img').src = 'https://i.giphy.com/xTk9ZvMnbIiIew7IpW.webp';
                    document.getElementById('process').style.display='block';
                    // Initiating WebSocket connection after successful form submission
                    checkVirtualTryOnStatus(data.id);
                }
            })
            .catch(error => {
                console.error('Submission error:', error);
                alert('An error occurred while processing. Please try again.');
            })
          
        }

        function checkVirtualTryOnStatus(vtonId) {
            const checkUrl = `https://virtual-try-on.eshtyle.com/api/check-vton?id=${vtonId}`;
        
            fetch(checkUrl, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    // Include other headers if needed, like authorization tokens
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(responseData => {
                console.log('Response received:', responseData);
        
                if (responseData.message === 'VirtualTryOn is Ready') {
                    alert('Your virtual try-on images are ready!');
                    document.getElementById('output_img').src = 'https://virtual-try-on.eshtyle.com' + responseData.output_image;
                    document.getElementById('submitbutton').disabled = false;
                    document.getElementById('process').style.display='none';


                }
                
                else if (responseData.message === "Something Went Wrong") {
                    alert("Something Went Wrong !!  contact the support team for further assistance. ");
                    document.getElementById('output_img').src = "https://t4.ftcdn.net/jpg/05/24/04/51/360_F_524045110_UXnCx4GEDapddDi5tdlY96s4g0MxHRvt.jpg"
                }

                else {
                    console.log('VirtualTryOn is not ready, will recheck in 15 seconds...');
                    setTimeout(() => checkVirtualTryOnStatus(vtonId), 15000);
                }
            })
            .catch(error => console.error('Error checking VirtualTryOn status:', error));
        }
        
        // Initiate the polling when needed
        function initiateCheck(vtonId) {
            // Start the first check after 30 seconds
            setTimeout(() => checkVirtualTryOnStatus(vtonId), 30000);
        }
        



    </script>

</body>

</html>